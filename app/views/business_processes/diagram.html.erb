<%- model_class = BusinessProcess -%>
<div class="page-header">
  <h1><%=t '.title', :default => t("helpers.process_modell") %></h1>
</div>

<div class="hero-unit" style="height: 400px;">
  <% @business_process.children.each do |bp| %>
  <%= link_to bp.name, business_process_path(bp),
      class: "btn btn #{btnclass(bp.process_class.color)} process" , id: bp.id %>
  <% end %>
</div>

<div class="form-actions">
  <%= link_to t('.back', :default => t("helpers.links.back")),
              business_processes_path, :class => 'btn'  %>
  <%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_business_process_path(@business_process), :class => 'btn' %>
  <%= link_to t('.edit', :default => t("helpers.links.reset")),
              reset_business_process_path(@business_process), :class => 'btn' %>
  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              business_process_path(@business_process),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
</div>

<% content_for :javascript do %>
  <script>
	  $(function() {
		  $( ".process" ).draggable({ grid: [ 25,25 ] });
		  $( ".process" ).bind( "dragstop", function(event, ui) {
        $.ajax({
          url: "/business_processes/1/diagram.js",
          type: "POST",
          data: {coords: {
            id: this.id,
            x: ui.offset.left,
            y: ui.offset.top }},
     	  });
  	  });
 	    <% @business_process.children.each do |bp| %>
     	  $("#<%= bp.id %>").offset({left: <%= bp.x || 500 %>, top: <%= bp.y || 200 %>});
    	<% end %>
  	});
  </script>
<% end %>
